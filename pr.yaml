steps:
  # Step 1: Build Docker image (just like the CI process)
  - name: 'gcr.io/cloud-builders/docker'
    args:
      [
        'build',
        '-t',
        'asia-southeast1-docker.pkg.dev/western-emitter-461905-e7/cicd-testing/my-app:$SHORT_SHA',
        '.'
      ]

  # Step 2: Run unit tests or integration tests if needed (optional)
  - name: 'gcr.io/cloud-builders/docker'
    args:
      [
        'run',
        '--rm',
        'asia-southeast1-docker.pkg.dev/western-emitter-461905-e7/cicd-testing/my-app:$SHORT_SHA',
        'python',  # Example test command, adjust as per your app's testing mechanism
        '-m',
        'unittest'
      ]

images:
  - 'asia-southeast1-docker.pkg.dev/western-emitter-461905-e7/cicd-testing/my-app:$SHORT_SHA'
